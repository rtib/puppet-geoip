<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.34
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-geoip">geoip</h1>

<h2 id="label-Project+status">Project status</h2>

<p>GitHub: <a href="https://github.com/rtib/puppet-geoip/issues"><img src="https://img.shields.io/github/issues/rtib/puppet-geoip.svg"></a> <img src="https://img.shields.io/github/commit-activity/y/rtib/puppet-geoip"> <img src="https://img.shields.io/github/last-commit/rtib/puppet-geoip"></p>

<p>Nightly CI Workflow: [<a href="https://github.com/rtib/puppet-geoip/actions/workflows/ci.yaml"><img src="https://github.com/rtib/puppet-geoip/actions/workflows/ci.yaml/badge.svg"></a></p>

<p>Puppet Forge: <img src="https://img.shields.io/puppetforge/pdk-version/trepasi/geoip.svg"> <a href="https://github.com/rtib/puppet-geoip/actions/workflows/release.yaml"><img src="https://github.com/rtib/puppet-geoip/actions/workflows/release.yaml/badge.svg"></a> <a href="https://forge.puppet.com/trepasi/geoip"><img src="https://img.shields.io/puppetforge/v/trepasi/geoip.svg"></a></p>

<h2 id="label-Table+of+Contents">Table of Contents</h2>
<!-- @import "[TOC]" depthFrom=2 depthTo=3 orderedList=false --><!-- code_chunk_output --><ul><li>
<p><a href="#geoip">geoip</a></p>
</li><li>
<p><a href="#project-status">Project status</a></p>
</li><li>
<p><a href="#table-of-contents">Table of Contents</a></p>
</li><li>
<p><a href="#description">Description</a></p>
</li><li>
<p><a href="#setup">Setup</a></p>
<ul><li>
<p><a href="#what-geoip-affects">What geoip affects</a></p>
</li><li>
<p><a href="#setup-requirements">Setup Requirements</a></p>
</li><li>
<p><a href="#beginning-with-geoip">Beginning with geoip</a></p>
</li></ul>
</li><li>
<p><a href="#usage">Usage</a></p>
<ul><li>
<p><a href="#configuring-versions-less-than-311">Configuring versions less than 3.1.1</a></p>
</li><li>
<p><a href="#configuring-versions-311-and-later">Configuring versions 3.1.1 and later</a></p>
</li><li>
<p><a href="#upgrading-to-311-or-later">Upgrading to 3.1.1 or later</a></p>
</li><li>
<p><a href="#updating-databases">Updating databases</a></p>
</li><li>
<p><a href="#update-scheduling">Update scheduling</a></p>
</li></ul>
</li><li>
<p><a href="#reference">Reference</a></p>
</li><li>
<p><a href="#limitations">Limitations</a></p>
<ul><li>
<p><a href="#debian-11---bullseye">Debian 11 - Bullseye</a></p>
</li></ul>
</li><li>
<p><a href="#development">Development</a></p>
</li><li>
<p><a href="#copyright">Copyright</a></p>
</li></ul>
<!-- /code_chunk_output -->
<h2 id="label-Description">Description</h2>

<p>This Puppet module installs and maintains tools and processes to use GeoIP databases from <a href="https://www.maxmind.com">MaxMind</a>. These include the lookup tools for lookup and update the databases. It will manage the configuration for the update tool which enables to set up your subscription settings, product IDs and other settings, e.g. proxy settings. If systemd is available, a service is defined in order to enable a seamless update process.</p>

<h2 id="label-Setup">Setup</h2>

<h3 id="label-What+geoip+affects">What geoip affects</h3>

<p>The module will install some packages, create a configuration file and a systemd service unit.</p>

<h3 id="label-Setup+Requirements">Setup Requirements</h3>

<p>Neccesary packages must be available for installation by the package management tools used on the target system. As this is not the case on many systems, you have to take care about the availability of the packages. The list of the packages to be installed is a configuration option.</p>

<h3 id="label-Beginning+with+geoip">Beginning with geoip</h3>

<p>The only thing to start with geoip is to include the class in the manifest of your nodes.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_contain'>contain</span> <span class='id identifier rubyid_geoip'>geoip</span>
</code></pre>

<p>All configuration parameter can be assigned hiera. The default values are also lookuped up by hiera using the database shipped with the module.</p>

<h2 id="label-Usage">Usage</h2>

<p>Note, that MaxMind does not allow to download databases without subscription, but there is a free tier which can be used to download three GeoLite2 databases.</p>

<p>The configuration depends on the version of the <code>geoipupdate</code> tool to use, as there is a difference between versions starting at 3.1.1 and the older ones. The module referns to these settings via parameter <code>geoip::config_version</code> using the value <code>lt311</code> for versions less than 3.1.1 and value <code>ge311</code> for version greater or equal to 3.1.1.</p>

<h3 id="label-Configuring+versions+less+than+3.1.1">Configuring versions less than 3.1.1</h3>

<pre class="code ruby"><code class="ruby">geoip::config:
  userid: &#39;&lt;yourAccountID&gt;&#39;
  licensekey: &#39;&lt;yourLicenseKey&gt;&#39;
</code></pre>

<p>Replace the values for <code>userid</code> and <code>licensekey</code> with actual data from your subscription.</p>

<p>Optional configuration settings are available, enable to set:</p>
<ul><li>
<p><code>productids</code>: array of productids of the databases you want to download; it defaults to the freely available databases <code>[&#39;GeoLite2-ASN&#39;, &#39;GeoLite2-City&#39;, &#39;GeoLite2-Country&#39;]</code></p>
</li><li>
<p><code>database_directory</code>: where to store the database files</p>
</li><li>
<p><code>protocol</code>: HTTP or HTTPS</p>
</li><li>
<p><code>proxy</code>: URL to the Proxy service allowing access to the Internet</p>
</li><li>
<p><code>proxy_user_password</code>: Username and password to the Proxy, if needed.</p>
</li><li>
<p><code>skip_hostname_verification</code>: Disable hostname verification.</p>
</li><li>
<p><code>skip_peer_verification</code>: Disable certificate validation.</p>
</li></ul>

<p>Refer to your subscription to get the list of <code>productids</code> you are allowed to use.</p>

<h3 id="label-Configuring+versions+3.1.1+and+later">Configuring versions 3.1.1 and later</h3>

<pre class="code ruby"><code class="ruby">geoip::config:
  accountid: &#39;&lt;yourAccountID&gt;&#39;
  licensekey: &#39;&lt;yourLicenseKey&gt;&#39;
</code></pre>

<p>Replace the values for <code>accountid</code> and <code>licensekey</code> with actual data from your subscription.</p>

<p>Optional configuration settings are available, enable to set:</p>
<ul><li>
<p><code>editionids</code>: array of IDs of the databases you want to download; it defaults to the freely available databases <code>[&#39;GeoLite2-ASN&#39;, &#39;GeoLite2-City&#39;, &#39;GeoLite2-Country&#39;]</code></p>
</li><li>
<p><code>database_directory</code>: where to store the database files</p>
</li><li>
<p><code>host</code>: the update server to use</p>
</li><li>
<p><code>proxy</code>: URL to the Proxy service allowing access to the Internet</p>
</li><li>
<p><code>proxy_user_password</code>: Username and password to the Proxy, if needed.</p>
</li><li>
<p><code>lock_file</code>: location of the lock file to use to prevent running multiple updates at the same time</p>
</li></ul>

<p>Refer to your subscription to get the list of <code>editionids</code> you are allowed to use.</p>

<h3 id="label-Upgrading+to+3.1.1+or+later">Upgrading to 3.1.1 or later</h3>

<p>Versions of <code>geoipupdate</code> 3.1.1 or later will accept the configuration file format of former versions. Making use of that, the module provides the <code>geoip::config_version</code> parameter to chose the configuration format, which defaults to <code>lt311</code>, but is overwritten with <code>ge311</code> for operating system versions known to provide geoipupdate version 3.1.1 or later (e.g. Debian Buster). While it should not needed to set this parameter in normal operation, during upgrade of multiple nodes, the parameter allows to pin the configuration version to the needed format.</p>

<p>Note, that a license keys issued for versions less than 3.1.1 of later will not work in both configurations, <code>geoipupdate</code> versions less than 3.1.1 will fail accessing the update server when a key issed for 3.1.1 or later is provided in the <code>lt311</code> configuration.</p>

<h3 id="label-Updating+databases">Updating databases</h3>

<p>In order to update your databases you may use the <code>geoipupdate</code> tool with the configuration file created by this puppet module.</p>

<p>If you haven&#39;t disabled <code>geoip::manage_service</code>, you may start the update service named <code>geoip::service_name</code> (defaults to <code>geoip_update</code>), which will do the update.</p>

<p>By default, the update service will retry after 5 minutes if the update was failed by any reason. This behaviour can be changed via <code>geoip::systemd::service::restart</code> and <code>geoip::systemd::service::restart_sec</code> defining SystemD restart behaviour.</p>

<h3 id="label-Update+scheduling">Update scheduling</h3>

<p>Updates, if handled by SystemD, can be scheduled by setting <code>geoip::update_timers</code> an array of timer descriptions. These timer descriptions apply on systemd timer unit OnCalendar options. For correct syntax of these timestamps see <a href="https://www.freedesktop.org/software/systemd/man/systemd.time.html#Parsing%20Timestamps">systemd.time(7)#Parsing Timestamps</a>.</p>

<p>The parameter <code>geoip::update_scatter</code> defines the seconds for systemd timer AccuracySec option (see <a href="https://www.freedesktop.org/software/systemd/man/systemd.timer.html#AccuracySec=">systemd.timer(5)#AccuracySec</a>) to prevent multiple nodes to update at the same time.</p>

<h2 id="label-Reference">Reference</h2>

<p>Automatically generated reference documentation is available in the <a href="https://github.com/rtib/puppet-geoip/blob/main/REFERENCE.md">REFERENCE.md</a> file or at <a href="https://rtib.github.io/puppet-geoip/">rtib.github.io/puppet-geoip/</a>.</p>

<h2 id="label-Limitations">Limitations</h2>

<p>For supported operating systems and dependencies, see <a href="https://github.com/rtib/puppet-cassandra/blob/main/metadata.json">metadata.json</a>.</p>

<p>Extensive itegration tests are run nightly to assure quality and compatibility with next releases.</p>

<h3 id="label-Debian+11+-+Bullseye">Debian 11 - Bullseye</h3>

<p>The <code>geoipupdate</code> package available in Debian Bullseye release is shipping SystemD units for service and timer to conduct weekly updates of the database. Default behaviour of the module will shift to use <code>systemd_config: dropin</code> on Debian-11 by default to rebuild the functionality on the changed environment.</p>

<h2 id="label-Development">Development</h2>

<p>The module is developed using recent <a href="https://puppet.com/docs/pdk/2.x/pdk.html">Puppet Development Kit</a>, <a href="https://puppet.com/docs/pdk/1.x/pdk_testing.html">validated</a> and extensively tested using <a href="https://github.com/puppetlabs/puppet_litmus">Puppet Litmus</a>. Automated workflows, implemented with <a href="https://docs.github.com/en/actions">GitHub Actions</a> are run on demand and nightly, doing validation, spec tests and continuous integration tests.</p>

<p>Note, that <a href="https://github.com/rtib/puppet-geoip/actions/workflows/ci-acceptance.yaml">CI-Acceptance</a> workflow is not applied to pull requests automatically, as it needs credentials setup as secrets to work. A pull request, however, will only be merged if these tests also succeed.</p>

<p>As an open project, you are welcome to contribute to this module. Currently, there is no contribution guide specific to this module, general information about the workflow may apply. In case of questions feel free to open a issue or join community Slack channels #forge-modules, #puppet, #puppet-dev, #testing on slack.puppet.com.</p>

<p>Issues and pull requests will be addressed in a timely manner, according to community best practice. Releases are going to be published on demand, after having merged an set of sufficiently important changes and all tests succeeded. There may be automated rule enforcement in place to provide a healthy issue lifecycle.</p>

<h2 id="label-Copyright">Copyright</h2>

<p>This product is tested using GeoLite2 data created by MaxMind, available from <a href="https://www.maxmind.com">www.maxmind.com</a>.</p>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>